(function(e,t){typeof define=="function"&&define.amd?define(["d3","./Surface","css!./ResizeSurface"],t):e.common_ResizeSurface=t(e.d3,e.common_Surface)})(this,function(e,t){function n(){t.call(this),this.handleWidth=8,this.handles=[{loc:"NW"},{loc:"N"},{loc:"NE"},{loc:"E"},{loc:"SE"},{loc:"S"},{loc:"SW"},{loc:"W"}];var n=this;this.dispatch=e.dispatch("sizestart","size","sizeend"),this.drag=e.behavior.drag().origin(function(e){return e}).on("dragstart",function(t){n.dispatch.sizestart(n,t.loc),n.allowResize()&&(e.event.sourceEvent.stopPropagation(),n._dragHandlePos={x:t.x,y:t.y},n._dragStartPos=n.pos(),n._dragStartSize=n.size(),n._prevPosSize={x:n._dragStartPos.x,y:n._dragStartPos.y,width:n._dragStartSize.width,height:n._dragStartSize.height},n._textPosSize=n._text.getBBox(!0),n._iconPosSize=n._icon.getBBox(!0),n.showContent(!1))}).on("drag",function(t){if(n.allowResize()){e.event.sourceEvent.stopPropagation();var r=e.event.x-n._dragHandlePos.x,i=e.event.y-n._dragHandlePos.y,s={x:0,y:0,w:0,h:0};switch(t.loc){case"NW":s.x=r/2,s.w=-r;case"N":s.y=i/2,s.h=-i;break;case"NE":s.y=i/2,s.h=-i;case"E":s.x=r/2,s.w=r;break;case"SE":s.x=r/2,s.w=r;case"S":s.y=i/2,s.h=i;break;case"SW":s.y=i/2,s.h=i;case"W":s.x=r/2,s.w=-r}var o={x:n._dragStartPos.x+s.x,y:n._dragStartPos.y+s.y,width:n._dragStartSize.width+s.w,height:n._dragStartSize.height+s.h};o.width<n._iconPosSize.width*2+n._textPosSize.width&&(o.x=n._prevPosSize.x,o.width=n._prevPosSize.width),o.height<n._textPosSize.height+48&&(o.y=n._prevPosSize.y,o.height=n._prevPosSize.height),n.pos({x:o.x,y:o.y},!1,!1).size({width:o.width,height:o.height}).render().getBBox(!0),n.dispatch.size(n,t.loc),n._prevPosSize=o}}).on("dragend",function(t){n.allowResize()&&(e.event.sourceEvent.stopPropagation(),n.showContent(!0).render(),n._container.getBBox(!0),n._titleRect.getBBox(!0),n.dispatch.sizeend(n,t.loc))})}return n.prototype=Object.create(t.prototype),n.prototype.constructor=n,n.prototype._class+=" common_ResizeSurface",n.prototype.publish("allowResize",!0,"boolean","Sets if surface can be resized",null,{tags:["Private","Shared"]}),n.prototype.move=function(e){var n=t.prototype.move.apply(this,arguments);return this.updateHandles(this._domNode,this._element),n},n.prototype.update=function(e,n){t.prototype.update.apply(this,arguments),this.updateHandles(e,n)},n.prototype.updateHandles=function(t,n){var r=this._parentElement.selectAll("rect").data(this.handles,function(e){return e.loc});r.enter().append("rect").attr("class",function(e){return"resize"+e.loc}).call(this.drag);var i=this._pos.x+this._container._pos.x-this._container.width()/2,s=this._pos.y+this._titleRect._pos.y-this._titleRect.height()/2,o=this._pos.x+this._container._pos.x+this._container.width()/2,u=this._pos.y+this._container._pos.y+this._container.height()/2,a=o-i,f=u-s,l=this;r.each(function(t){switch(t.loc){case"NW":t.x=i-l.handleWidth/2,t.y=s-l.handleWidth/2,t.width=l.handleWidth,t.height=l.handleWidth;break;case"N":t.x=i+l.handleWidth/2,t.y=s-l.handleWidth/2,t.width=a-l.handleWidth,t.height=l.handleWidth;break;case"NE":t.x=o-l.handleWidth/2,t.y=s-l.handleWidth/2,t.width=l.handleWidth,t.height=l.handleWidth;break;case"E":t.x=o-l.handleWidth/2,t.y=s+l.handleWidth/2,t.width=l.handleWidth,t.height=f-l.handleWidth;break;case"SE":t.x=o-l.handleWidth/2,t.y=u-l.handleWidth/2,t.width=l.handleWidth,t.height=l.handleWidth;break;case"S":t.x=i+l.handleWidth/2,t.y=u-l.handleWidth/2,t.width=a-l.handleWidth,t.height=l.handleWidth;break;case"SW":t.x=i-l.handleWidth/2,t.y=u-l.handleWidth/2,t.width=l.handleWidth,t.height=l.handleWidth;break;case"W":t.x=i-l.handleWidth/2,t.y=s+l.handleWidth/2,t.width=l.handleWidth,t.height=f-l.handleWidth}e.select(this).attr("x",t.x).attr("y",t.y).attr("width",t.width).attr("height",t.height)})},n});