(function(e,t){typeof define=="function"&&define.amd?define(["d3","./Widget","./Transition"],t):e.common_SVGWidget=t(e.d3,e.common_Widget,e.common_Transition)})(this,function(e,t,n){function r(){t.call(this),this._tag="g",this._boundingBox=null,this.transition=new n(this),this._drawStartPos="center"}r.prototype=Object.create(t.prototype),r.prototype.constructor=r,r.prototype._class+=" common_SVGWidget",r.prototype.move=function(e,t){var n=this.pos.apply(this,arguments);return arguments.length&&(t?this._element.transition().duration(t):this._element).attr("transform","translate("+e.x+" "+e.y+")"),n},r.prototype.size=function(e){var n=t.prototype.size.apply(this,arguments);return arguments.length&&(this._boundingBox=null),n},r.prototype.resize=function(e){var n=t.prototype.resize.apply(this,arguments);if(this._parentRelativeDiv){this._parentRelativeDiv.style({width:this._size.width+"px",height:this._size.height+"px"});switch(this._drawStartPos){case"origin":this.pos({x:0,y:0});break;case"center":default:this.pos({x:this._size.width/2,y:this._size.height/2})}}return this._parentElement.attr("width",this._size.width).attr("height",this._size.height),n},r.prototype.target=function(t){if(!arguments.length)return this._target;if(this._target&&t&&this._target.__data__.id!==t.__data__.id)throw"Target can only be assigned once.";this._target=t;if(typeof this._target=="string"||this._target instanceof String)this._target=document.getElementById(this._target);if(this._target instanceof SVGElement){this._parentElement=e.select(this._target),this._parentWidget=this._parentElement.datum();if(!this._parentWidget||this._parentWidget._id===this._id)this._parentWidget=this.locateParentWidget(this._target.parentNode);this._parentOverlay=this.locateOverlayNode()}else this._target?(this._parentRelativeDiv=e.select(this._target).append("div").style({position:"relative"}),this._parentElement=this._parentRelativeDiv.append("svg").style({position:"absolute",top:0,left:0}),this._parentOverlay=this._parentRelativeDiv.append("div").style({position:"absolute",top:0,left:0}),this.resize(this._size)):this.exit();return this},r.prototype.enter=function(e,n){t.prototype.enter.apply(this,arguments)},r.prototype.update=function(e,n){t.prototype.update.apply(this,arguments)},r.prototype.postUpdate=function(e,n){t.prototype.postUpdate.apply(this,arguments),this._drawStartPos==="origin"&&this._target instanceof SVGElement?this._element.attr("transform","translate("+(this._pos.x-this._size.width/2)+","+(this._pos.y-this._size.height/2)+")scale("+this._scale+")"):this._element.attr("transform","translate("+this._pos.x+","+this._pos.y+")scale("+this._scale+")")},r.prototype.exit=function(e,n){this._parentRelativeDiv&&(this._parentOverlay.remove(),this._parentElement.remove(),this._parentRelativeDiv.remove()),t.prototype.exit.apply(this,arguments)},r.prototype.getOffsetPos=function(){var e={x:0,y:0};return this._parentWidget?(e=this._parentWidget.getOffsetPos(),e.x+=this._pos.x,e.y+=this._pos.y,e):e},r.prototype.getBBox=function(e,t){if(e||this._boundingBox===null){var n=this._element.node();n instanceof SVGElement&&(this._boundingBox=n.getBBox())}return this._boundingBox===null?{x:0,y:0,width:0,height:0}:{x:(t?Math.round(this._boundingBox.x):this._boundingBox.x)*this._scale,y:(t?Math.round(this._boundingBox.y):this._boundingBox.y)*this._scale,width:(t?Math.round(this._boundingBox.width):this._boundingBox.width)*this._scale,height:(t?Math.round(this._boundingBox.height):this._boundingBox.height)*this._scale}},r.prototype.intersection=function(e,t){return this.intersectRect(e,t)};var i=function(e,t,n){return{x:e.x+(t.x-e.x)*n,y:e.y+(t.y-e.y)*n}},s=function(e,t,n,r){var i={type:"",points:[]},s=(r.x-n.x)*(e.y-n.y)-(r.y-n.y)*(e.x-n.x),o=(t.x-e.x)*(e.y-n.y)-(t.y-e.y)*(e.x-n.x),u=(r.y-n.y)*(t.x-e.x)-(r.x-n.x)*(t.y-e.y);if(u!==0){var a=s/u,f=o/u;0<=a&&a<=1&&0<=f&&f<=1?(i.type="Intersection",i.points.push({x:e.x+a*(t.x-e.x),y:e.y+a*(t.y-e.y)})):i.type="No Intersection"}else s===0||o===0?i.type="Coincident":i.type="Parallel";return i};r.prototype.intersectRect=function(e,t){var n=this.getOffsetPos(),r=this.getBBox();if(e.x===t.x&&e.y===t.y)return e;var i={x:n.x-r.width/2,y:n.y-r.height/2},o={x:n.x+r.width/2,y:n.y-r.height/2},u={x:n.x+r.width/2,y:n.y+r.height/2},a={x:n.x-r.width/2,y:n.y+r.height/2},f=s(i,o,e,t);return f.points.length?{x:f.points[0].x,y:f.points[0].y}:(f=s(o,u,e,t),f.points.length?{x:f.points[0].x,y:f.points[0].y}:(f=s(u,a,e,t),f.points.length?{x:f.points[0].x,y:f.points[0].y}:(f=s(a,i,e,t),f.points.length?{x:f.points[0].x,y:f.points[0].y}:null)))};var o=function(e,t,n,r){var s={type:"",points:[]},o=(r.x-n.x)*(r.x-n.x)+(r.y-n.y)*(r.y-n.y),u=2*((r.x-n.x)*(n.x-e.x)+(r.y-n.y)*(n.y-e.y)),a=e.x*e.x+e.y*e.y+n.x*n.x+n.y*n.y-2*(e.x*n.x+e.y*n.y)-t*t,f=u*u-4*o*a;if(f<0)s.type="Outside";else if(f===0)s.type="Tangent";else{var l=Math.sqrt(f),c=(-u+l)/(2*o),h=(-u-l)/(2*o);(c<0||c>1)&&(h<0||h>1)?c<0&&h<0||c>1&&h>1?s.type="Outside":s.type="Inside":(s.type="Intersection",0<=c&&c<=1&&s.points.push(i(n,r,c)),0<=h&&h<=1&&s.points.push(i(n,r,h)))}return s};return r.prototype.intersectCircle=function(e,t){var n=this.getOffsetPos(),r=this.radius(),i=o(n,r,e,t);return i.points.length?{x:i.points[0].x,y:i.points[0].y}:null},r.prototype.distance=function(e,t){return Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y))},r.prototype._pushMarkers=function(e,t){this.svgMarkerGlitch&&(e=e||this._element,e.selectAll("path[marker-start],path[marker-end]").attr("fixme-start",function(e){return this.getAttribute("marker-start")}).attr("fixme-end",function(e){return this.getAttribute("marker-end")}).attr("marker-start",null).attr("marker-end",null))},r.prototype._popMarkers=function(e,t){this.svgMarkerGlitch&&(e=e||this._element,e.selectAll("path[fixme-start],path[fixme-end]").attr("marker-start",function(e){return this.getAttribute("fixme-start")}).attr("marker-end",function(e){return this.getAttribute("fixme-end")}).attr("fixme-start",null).attr("fixme-end",null))},r.prototype._popMarkersDebounced=t.prototype.debounce(function(e,t){this.svgMarkerGlitch&&this._popMarkers(e,t)},250),r.prototype._fixIEMarkers=function(e,t){this.svgMarkerGlitch&&(this._pushMarkers(e,t),this._popMarkersDebounced(e,t))},r});