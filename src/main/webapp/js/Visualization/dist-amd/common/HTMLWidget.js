(function(e,t){typeof define=="function"&&define.amd?define(["d3","./Widget","./Transition"],t):e.common_HTMLWidget=t(e.d3,e.common_Widget,e.common_Transition)})(this,function(e,t,n){function r(){t.call(this),this._drawStartPos="origin",this._tag="div",this._boundingBox=null}return r.prototype=Object.create(t.prototype),r.prototype.constructor=r,r.prototype._class+=" common_HTMLWidget",r.prototype.calcFrameWidth=function(e){var t=parseFloat(e.style("padding-left"))+parseFloat(e.style("padding-right"))+parseFloat(e.style("margin-left"))+parseFloat(e.style("margin-right"))+parseFloat(e.style("border-left-width"))+parseFloat(e.style("border-right-width"));return t},r.prototype.calcWidth=function(e){return parseFloat(e.style("width"))-this.calcFrameWidth(e)},r.prototype.calcFrameHeight=function(e){var t=parseFloat(e.style("padding-top"))+parseFloat(e.style("padding-bottom"))+parseFloat(e.style("margin-top"))+parseFloat(e.style("margin-bottom"))+parseFloat(e.style("border-top-width"))+parseFloat(e.style("border-bottom-width"));return t},r.prototype.calcHeight=function(e){return parseFloat(e.style("height"))+this.calcFrameHeight(e)},r.prototype.hasHScroll=function(e){return e=e||this._element,e.property("scrollWidth")>e.property("clientWidth")},r.prototype.hasVScroll=function(e){return e=e||this._element,e.property("scrollHeight")>e.property("clientHeight")},r.prototype.clientWidth=function(){return this._size.width-this.calcFrameWidth(this._element)},r.prototype.clientHeight=function(){return this._size.height-this.calcFrameHeight(this._element)},r.prototype.getBBox=function(e,t){if(e||this._boundingBox===null){var n=this._element.node()?this._element.node().firstElementChild:null;if(n instanceof Element){var r=n.getBoundingClientRect();this._boundingBox={x:r.left,y:r.top,width:r.width,height:r.height}}}return this._boundingBox===null?{x:0,y:0,width:0,height:0}:{x:(t?Math.round(this._boundingBox.x):this._boundingBox.x)*this._scale,y:(t?Math.round(this._boundingBox.y):this._boundingBox.y)*this._scale,width:(t?Math.round(this._boundingBox.width):this._boundingBox.width)*this._scale,height:(t?Math.round(this._boundingBox.height):this._boundingBox.height)*this._scale}},r.prototype.resize=function(e){var n=t.prototype.resize.apply(this,arguments);return this._parentElement.style("width",this._size.width+"px").style("height",this._size.height+"px"),n},r.prototype.target=function(t){if(!arguments.length)return this._target;if(this._target&&t)throw"Target can only be assigned once.";this._target=t;if(typeof this._target=="string"||this._target instanceof String)this._target=document.getElementById(this._target);if(this._target instanceof SVGElement){var n=this.locateOverlayNode();this._parentElement=n.append("div").style({position:"absolute",top:0,left:0,overflow:"hidden"}),this._overlayElement=e.select(this._target);var r=this;this.oldPos=null,this.observer=new this.MutationObserver(function(e){r.syncOverlay()});var i=this._overlayElement.node();while(i)this.observer.observe(i,{attributes:!0}),i=i.parentNode}else if(this._target){this._parentElement=e.select(this._target);if(!this._size.width&&!this._size.height){var s=parseFloat(this._parentElement.style("width")),o=parseFloat(this._parentElement.style("height"));this.size({width:s,height:o})}this._parentElement=e.select(this._target).append("div")}else this.exit();return this},r.prototype.postUpdate=function(e,n){t.prototype.postUpdate.apply(this,arguments);if(this._drawStartPos==="origin")this._element.style({position:"relative",left:this._pos.x+"px",top:this._pos.y+"px"});else{var r=this.getBBox(!0);this._element.style({position:"relative","float":"left",left:this._pos.x+(this._size.width-r.width)/2+"px",top:this._pos.y+(this._size.height-r.height)/2+"px"})}},r.prototype.exit=function(e,n){this.observer&&this.observer.disconnect(),this.oldPos=null,this._parentElement&&this._parentElement.remove(),t.prototype.exit.apply(this,arguments)},r});