(function(e,t){typeof define=="function"&&define.amd?define(["d3","../common/SVGWidget","../common/TextBox","css!./Edge"],t):e.graph_Edge=t(e.d3,e.common_SVGWidget,e.common_TextBox)})(this,function(e,t,n){function r(){t.call(this),this._points=[],this._weight=100,this._strokeDasharray=null,this._hidden=!1,this._textBox=(new n).padding(0)}return r.prototype=Object.create(t.prototype),r.prototype.constructor=r,r.prototype._class+=" graph_Edge",r.prototype.publish("arcDepth",16,"number","Arc Depth",null,{tags:["Basic"]}),r.prototype.publish("tooltip","","string","Tooltip",null,{tags:["Private"]}),r.prototype.sourceVertex=function(e){return arguments.length?(this._sourceVertex=e,this):this._sourceVertex},r.prototype.targetVertex=function(e){return arguments.length?(this._targetVertex=e,this):this._targetVertex},r.prototype.sourceMarker=function(e){return arguments.length?(this._sourceMarker=e,this):this._sourceMarker},r.prototype.targetMarker=function(e){return arguments.length?(this._targetMarker=e,this):this._targetMarker},r.prototype.weight=function(e){return arguments.length?(this._weight=e,this):this._weight},r.prototype.strokeDasharray=function(e){return arguments.length?(this._strokeDasharray=e,this):this._strokeDasharray},r.prototype.points=function(e,t,n){return arguments.length?(this._points=e,this._elementPath&&this.update(null,this._element,t,n),this):this._points},r.prototype.hidden=function(e){return arguments.length?(this._hidden=e,this):this._hidden},r.prototype.text=function(e){return arguments.length?(this._textBox.text(e),this):this._textBox.text()},r.prototype.enter=function(e,n){t.prototype.enter.apply(this,arguments),this._elementPath=n.append("path"),this._tooltipElement=this._elementPath.append("title"),this._sourceMarker&&this._elementPath.attr("marker-start","url(#"+this._sourceMarker+")"),this._targetMarker&&this._elementPath.attr("marker-end","url(#"+this._targetMarker+")"),this._textBox.text()&&this._textBox.target(e).tooltip(this.tooltip()).render()},r.prototype.update=function(n,r,i,s){t.prototype.update.apply(this,arguments);var o=this;this.svgMarkerGlitch&&!s&&r.transition().duration((i?i:0)+100).each("start",function(e){o._pushMarkers(r,e)}).each("end",function(e){o._popMarkers(r,e)});var u=o._calculateEdgePoints(this._sourceVertex,this._targetVertex,this._points),a="";if(this._points.length||i||!0)a=e.svg.line().x(function(e){return e.x}).y(function(e){return e.y}).interpolate("bundle").tension(.75)(u);else{var f=u[2].x-u[0].x,l=u[2].y-u[0].y,c=Math.sqrt(f*f+l*l)*2;a="M"+u[0].x+","+u[0].y+"A"+c+","+c+" 0 0,1 "+u[2].x+","+u[2].y}var h=this._elementPath;i&&(h=h.transition().duration(i)),h.attr("opacity",this._hidden?0:1).attr("stroke-dasharray",this._strokeDasharray).attr("d",a),this._tooltipElement.text(this.tooltip()),this._textBox.text()&&this._textBox.tooltip(this.tooltip()).move(this._findMidPoint(u),i)},r.prototype._findMidPoint=function(e){var t=e.length/2;if(e.length%2)return e[Math.floor(t)];if(e.length){var n=e[t-1],r=e[t];return{x:(n.x+r.x)/2,y:(n.y+r.y)/2}}return{x:0,y:0}},r.prototype._calculateEdgePoints=function(e,t,n){if(!e||!t)return[{x:0,y:0},{x:0,y:0}];var r=n?n.slice():[],i=r.length===0?t.pos():r[0],s=r.length===0?e.pos():r[r.length-1];r.unshift(e.intersection(e._pos,i)),r.push(t.intersection(t._pos,s)),r[0]||(r[0]=e._pos),r[r.length-1]||(r[r.length-1]=t._pos);if(r.length===2&&r[0]&&r[1]){var o=r[0].x-r[1].x,u=r[0].y-r[1].y,a=Math.sqrt(o*o+u*u);if(a){var f=(r[0].x+r[1].x)/2-u*this.arcDepth()/100,l=(r[0].y+r[1].y)/2+o*this.arcDepth()/100;r=[{x:r[0].x,y:r[0].y},{x:f,y:l},{x:r[1].x,y:r[1].y}]}}return r},r});