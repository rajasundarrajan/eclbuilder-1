(function(e,t){typeof define=="function"&&define.amd?define(["d3","../common/SVGWidget","../api/I2DChart","../common/Text","../common/FAChar","../common/Utility","../api/ITooltip","css!./Bubble"],t):e.chart_Bubble=t(e.d3,e.common_SVGWidget,e.api_I2DChart,e.common_Text,e.common_FAChar,e.common_Utility,e.api_ITooltip)})(this,function(e,t,n,r,i,s,o){function u(r){t.call(this),n.call(this),o.call(this),this._drawStartPos="origin",this.labelWidgets={},this.d3Pack=e.layout.pack().sort(function(e,t){return e<t?-1:e>t?1:0}).size([this.width(),this.height()]).value(function(e){return e[1]})}return u.prototype=Object.create(t.prototype),u.prototype.constructor=u,u.prototype._class+=" chart_Bubble",u.prototype.implements(n.prototype),u.prototype.implements(o.prototype),u.prototype.publish("paletteID","default","set","Palette ID",u.prototype._palette.switch(),{tags:["Basic","Shared"]}),u.prototype.publish("useClonedPalette",!1,"boolean","Enable or disable using a cloned palette",null,{tags:["Intermediate","Shared"]}),u.prototype.size=function(e){var n=t.prototype.size.apply(this,arguments);return arguments.length&&this.d3Pack.size([this.width(),this.height()]),n},u.prototype.enter=function(e,n){t.prototype.enter.apply(this,arguments),this._selection=new s.SimpleSelection(n)},u.prototype.update=function(t,n){var s=this;this._palette=this._palette.switch(this.paletteID()),this.useClonedPalette()&&(this._palette=this._palette.cloneNotExists(this.paletteID()+"_"+this.id()));var o=n.selectAll(".node").data(this.data().length?this.d3Pack.nodes({children:this.cloneData()}).filter(function(e){return!e.children}):[],function(e){return e[0]});o.enter().append("g").attr("class","node").attr("opacity",0).call(this._selection.enter.bind(this._selection)).on("click",function(e){s.click(s.rowToObj(e),s.columns()[1],s._selection.selected(this))}).each(function(t){var n=e.select(this);n.append("circle").attr("r",function(e){return e.r}).on("mouseover.tooltip",function(e){s.tooltipShow(e,s.columns(),1)}).on("mouseout.tooltip",function(e){s.tooltipShow()}).on("mousemove.tooltip",function(e){s.tooltipShow(e,s.columns(),1)}),t.__viz_faChar?s.labelWidgets[t[0]]=(new i).char(t.__viz_faChar).target(this).render():s.labelWidgets[t[0]]=(new r).text(t[0]).target(this).render()}),o.transition().attr("opacity",1).each(function(t){var n=e.select(this),r={x:t.x,y:t.y};n.select("circle").transition().attr("transform",function(e){return"translate("+r.x+","+r.y+")"}).style("fill",function(e){return s._palette(e[0])}).attr("r",function(e){return e.r}).select("title").text(function(e){return e[0]+" ("+e[1]+")"});if(t.__viz_faChar)s.labelWidgets[t[0]].pos(r).render();else{var i=t[0],o=s.labelWidgets[t[0]].getBBox().width;t.r*2<16?i="":t.r*2<o&&(i=i[0]+"..."),s.labelWidgets[t[0]].pos(r).text(i).render()}}),o.exit().transition().style("opacity",0).remove()},u.prototype.exit=function(e,n){t.prototype.enter.apply(this,arguments),delete this._selection},u});