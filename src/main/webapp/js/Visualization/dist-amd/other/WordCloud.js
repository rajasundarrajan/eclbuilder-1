(function(e,t){typeof define=="function"&&define.amd?define(["d3","../common/SVGWidget","../api/I2DChart","../api/ITooltip","d3-cloud","css!./WordCloud"],t):e.other_WordCloud=t(e.d3,e.common_SVGWidget,e.api_I2DChart,e.api_ITooltip,e.d3.layout.cloud)})(this,function(e,t,n,r,i){function s(){t.call(this),n.call(this),r.call(this),this._prevOffsetX=this.offsetX(),this._prevOffsetY=this.offsetY(),this._prevZoom=this.zoom()}return s.prototype=Object.create(t.prototype),s.prototype.constructor=s,s.prototype._class+=" other_WordCloud",s.prototype.implements(n.prototype),s.prototype.implements(r.prototype),s.prototype.publish("paletteID","default","set","Palette ID",s.prototype._palette.switch(),{tags:["Basic","Shared"]}),s.prototype.publish("useClonedPalette",!1,"boolean","Enable or disable using a cloned palette",null,{tags:["Intermediate","Shared"]}),s.prototype.publish("fontFamily","Impact","string","Font Name",null,{tags:["Basic"]}),s.prototype.publish("fontSizeFrom",6,"number","Font Size From",null,{tags:["Basic"]}),s.prototype.publish("fontSizeTo",48,"number","Font Size To",null,{tags:["Basic"]}),s.prototype.publish("angleFrom",-60,"number","Angle From",null,{tags:["Basic"]}),s.prototype.publish("angleTo",60,"number","Angle To",null,{tags:["Basic"]}),s.prototype.publish("angleCount",5,"number","Angle Count",null,{tags:["Basic"]}),s.prototype.publish("padding",0,"number","Padding",null,{tags:["Intermediate"]}),s.prototype.publish("scaleMode","linear","set","Text scaling mode",["linear","log","sqrt","pow"],{tags:["Intermediate"]}),s.prototype.publish("spiral","archimedean","set","Text scaling mode",["archimedean","rectangular"],{tags:["Intermediate"]}),s.prototype.publish("offsetX",0,"number","X offset",null,{tags:["Advanced"]}),s.prototype.publish("offsetY",0,"number","Y offset",null,{tags:["Advanced"]}),s.prototype.publish("zoom",1,"number","Zoom",null,{tags:["Advanced"]}),s.prototype.data=function(e){var n=t.prototype.data.apply(this,arguments);return arguments.length&&(this._vizData=e.map(function(e){var t={};for(var n in e)t["__viz_"+n]=e[n];return t})),n},s.prototype.enter=function(n,r){t.prototype.enter.apply(this,arguments),this._root=r.append("g"),this._canvas=document.createElement("canvas");var s=this;this._zoom=e.behavior.zoom().scaleExtent([.1,10]).on("zoom",function(){s.zoomed(s._zoom,e.event.translate,e.event.scale)}),r.call(this._zoom),this._cloud=(new i).canvas(this._canvas)},s.prototype.update=function(n,r){function a(e,t){var n=i._root.selectAll("text").data(e,function(e){return e.__viz_0?e.__viz_0.toLowerCase():""});n.enter().append("text").attr("text-anchor","middle").text(function(e){return e.__viz_0}).on("click",function(e){i.click({label:e.__viz_0,weight:e.__viz_1})}).style("opacity",1e-6).on("mouseover.tooltip",function(e){i.tooltipShow([e.__viz_0,e.__viz_1],i.columns(),1)}).on("mouseout.tooltip",function(e){i.tooltipShow()}).on("mousemove.tooltip",function(e){i.tooltipShow([e.__viz_0,e.__viz_1],i.columns(),1)}),n.style("font-size",function(e){return o(e.__viz_1)+"px"}).style("font-family",i.fontFamily()).transition().duration(1e3).attr("transform",function(e){return"translate("+[e.x,e.y]+")rotate("+e.rotate+")"}).style("fill",function(e){return i._palette(e.__viz_0?e.__viz_0.toLowerCase():"")}).style("opacity",1),n.exit().transition().duration(1e3).style("opacity",1e-4).remove()}t.prototype.update.apply(this,arguments),this._palette=this._palette.switch(this.paletteID()),this.useClonedPalette()&&(this._palette=this._palette.cloneNotExists(this.paletteID()+"_"+this.id())),this.zoomed(this,[this.offsetX(),this.offsetY()],this.zoom());var i=this,s=e.extent(this._vizData,function(e){return e.__viz_1}),o=e.scale[this.scaleMode()]().domain(s).range([this.fontSizeFrom(),this.fontSizeTo()]),u=e.scale.linear().domain([0,i.angleCount()-1]).range([i.angleFrom(),i.angleTo()]);this._cloud.stop().size([this.width(),this.height()]).words(this._vizData).font(this.fontFamily()).padding(this.padding()).spiral(this.spiral()).text(function(e){return e.__viz_0}).fontSize(function(e){return o(e.__viz_1)}).rotate(function(){return u(~~(Math.random()*i.angleCount()))}).on("end",a).start()},s.prototype.zoomed=function(e,t,n){if(t[0]!==this._prevOffsetX||t[1]!==this._prevOffsetY||n!==this._prevZoom){this._root.attr("transform","translate("+t[0]+","+t[1]+")"+"scale("+n+")");switch(e){case this:this._zoom.scale(n).translate(t);break;case this._zoom:this.offsetX(t[0]),this.offsetY(t[1]),this.zoom(n)}this._prevOffsetX=t[0],this._prevOffsetY=t[1],this._prevZoom=n}},s});