(function(e,t){typeof define=="function"&&define.amd?define(["../common/Widget","../common/HTMLWidget","./Persist","./PropertyEditor","css!./ThemeEditor"],t):e.other_PropertyEditor=t(e.common_Widget,e.common_HTMLWidget,e.other_Persist,e.other_PropertyEditor)})(this,function(e,t,n,r){function i(){t.call(this),this._tag="div",this._current_grouping=undefined,this._showing_columns=undefined,this._showing_data=undefined,this.columns(["Key","Value"]),this._contentEditors=[],this._showSettings=!0,this._defaultThemes=[],this._widgetObjsById={}}function l(e){var t=e.split(/(?=[0-9A-Z])/).map(function(e){return e.length>1?e+" ":e}).join("");return t.replace(/(?:^|\s)\S/g,function(e){return e.toUpperCase()})}function c(e,t,n,r){function c(e,t){var n="";return e.set.forEach(function(e){var r=e===t?" selected":"";n+="<option value='"+e+"'"+r+">"+e+"</option>"}),n}var i="",s="te-input-"+e.id+"-"+r,o;typeof e.ext!="undefined"&&typeof e.ext.inputType!="undefined"&&(o=e.ext.inputType),typeof e.inputID!="undefined"&&(s=e.inputID);var u="data-paramid='"+e.id+"' data-wids='"+n.map(function(e){return typeof e.widget=="object"?e.widget._id:e}).join(",")+"'";switch(e.type){case"boolean":var a=t?" checked":"";i="<input id='"+s+"' "+u+" type='checkbox' class='te-checkbox te-input'"+a+">";break;case"number":typeof o!="undefined"?o==="textarea"?i="<textarea id='"+s+"' class='te-textarea te-input' "+u+">"+t+"</textarea>":o==="range"&&(i="<input id='"+s+"' class='te-input' type='range' "+u+" value='"+t+"'  min='"+e.ext.min+"' max='"+e.ext.max+"' step='"+e.ext.step+"'>"):i="<input id='"+s+"' type='text' class='te-text te-input' "+u+" value='"+t+"'>";break;case"string":typeof o!="undefined"?o==="textarea"&&(i="<textarea id='"+s+"' class='te-textarea te-input' "+u+">"+t+"</textarea>"):i="<input id='"+s+"' type='text' class='te-text te-input' value='"+t+"' "+u+">";break;case"html-color":var f=t===""?"":" value='"+t+"'";i="<input id='"+s+"' type='text' class='te-html-color-input te-input' "+u+" "+f+">",i+="<input type='color' class='te-html-color-button te-input' "+u+" "+f+">";break;case"set":var l=c(e,t);i="<select id='"+s+"' class='te-select te-input'"+u+">"+l+"</select>";break;case"array":i="<textarea id='"+s+"' class='te-textarea te-input' data-type='array' "+u+">"+t+"</textarea>";break;default:}return typeof e.ext.saveButton!="undefined"&&(i+="<button id='"+e.ext.saveButtonID+"'>"+e.ext.saveButton+"</button>"),i}var s=function(e){return typeof window.g_defaultThemes=="function"&&window.g_defaultThemes(e),JSON.parse(localStorage.getItem("themeEditorThemes")||"{}")},o=function(e){return typeof window.g_defaultSerials=="function"&&window.g_defaultSerials(e),JSON.parse(localStorage.getItem("themeEditorSerials")||"{}")},u=function(e){var t=s(),n=[];for(var r in t)n.push(r);return typeof e!="undefined"&&typeof n[e]!="undefined"&&(n=n[e]),n},a=function(e){var t=o(),n=[];for(var r in t)n.push(r);return typeof e!="undefined"&&typeof n[e]!="undefined"&&(n=n[e]),n};i.prototype=Object.create(t.prototype),i.prototype._class+=" other_ThemeEditor",i.prototype.publish("themeMode",!0,"boolean","Edit default values",null,{tags:["Basic"]}),i.prototype.publish("saveTheme","","string","Save Theme",null,{tags:["Basic","Theme"],saveButton:"Save",saveButtonID:"te-save-button"}),i.prototype.publish("loadedTheme",u(1),"set","Loaded Theme",u(),{tags:["Basic","Theme"]}),i.prototype.publish("saveSerial","","string","Save Serial",null,{tags:["Basic","Serial"],saveButton:"Save",saveButtonID:"te-save-button"}),i.prototype.publish("loadedSerial",a(0),"set","Loaded Serial",a(),{tags:["Basic","Serial"]}),i.prototype.publish("showColumns",!0,"boolean","Show Columns",null,{tags:["Intermediate"]}),i.prototype.publish("showData",!0,"boolean","Show Data",null,{tags:["Intermediate"]}),i.prototype.publish("shareCountMin",1,"number","Share Count Min",null,{tags:["Private"]}),i.prototype.publish("paramGrouping","By Param","set","Param Grouping",["By Param","By Widget"],{tags:["Private"]}),i.prototype.publish("editorComplexity","Basic","set","Choose what publish properties to display within the editor.",["Basic","Intermediate","Advanced","Private"],{tags:["Private"]}),i.prototype.publish("sectionTitle","","string","Section Title",null,{tags:["Private"]}),i.prototype.publish("collapsibleSections",!0,"boolean","Collapsible Sections",null,{tags:["Intermediate"]}),i.prototype.getThemes=s,i.prototype.getSerials=o,i.prototype.getDefaultThemes=u,i.prototype.getDefaultSerials=a,i.prototype.showSettings=function(e){return arguments.length?(this._showSettings=e,this):this._showSettings},i.prototype.onChange=function(e,t){},i.prototype.enter=function(e,n){t.prototype.enter.apply(this,arguments),this._parentElement.style("overflow","auto")};var f=function(e){var t=!1;return typeof e._current_grouping=="undefined"?e._current_grouping=e._group_params_by:e._current_grouping!==e._group_params_by&&(t=!0),typeof e._showing_columns=="undefined"?e._showing_columns=e.showColumns():e._showing_columns!==e.showColumns()&&(t=!0),typeof e._showing_data=="undefined"?e._showing_data=e.showData():e._showing_data!==e.showData()&&(t=!0),t};return i.prototype.widgetProperty=function(e,t,n){return n===undefined?e[t]():e[t](n)},i.prototype.load=function(){},i.prototype.save=function(){},i.prototype.needsPropTableRedraw=function(e,t){var n=document.getElementById("te-themeEditorOptions")===null;return n},i.prototype.update=function(e,r){t.prototype.update.apply(this,arguments),f(this)&&r.selectAll("#"+this._id+" > table").remove(),this._current_grouping=this.paramGrouping(),this._widgetObjsById[this._id]=this,this._sharedProperties=this.findSharedProperties(this.data());var i=this.needsPropTableRedraw();if(i&&this.showSettings()){var s=n.discover(this);for(var o in s)if(s[o].ext.tags.indexOf(this.editorComplexity())!==-1){var u=this[s[o].id]();if(s[o].id==="loadedTheme"||s[o].id==="loadedSerial")s[o].inputID="te-load-theme";s[o].input=c(s[o],u,[this._id],this._id)}else delete s[o];e.innerHTML=this.propertiesTableHtml(s);var a=document.createEvent("Events");a.initEvent("TE Properties Ready",!0,!0),document.dispatchEvent(a)}this.buildTableObjects(e,this._sharedProperties),this.initFunctionality(e)},i.prototype.exit=function(e,n){t.prototype.exit.apply(this,arguments)},i.prototype.click=function(e){},i.prototype.propertiesTableHtml=function(e){var t={id:"te-themeEditorOptions",label:"Editor Options",rowArr:[]},n={id:"te-tableModeOptions",label:this.themeMode()?"Save/Load Theme":"Save/Load Serial",rowArr:[]};for(var r in e)this.themeMode()?e[r].ext.tags.indexOf("Theme")===-1&&e[r].ext.tags.indexOf("Serial")===-1?t.rowArr.push({th:l(e[r].id),td:e[r].input,trClass:"propertyRow"}):e[r].ext.tags.indexOf("Theme")!==-1&&n.rowArr.push({th:l(e[r].id),td:e[r].input,trClass:"propertyRow"}):e[r].ext.tags.indexOf("Serial")===-1&&e[r].ext.tags.indexOf("Theme")===-1?t.rowArr.push({th:l(e[r].id),td:e[r].input,trClass:"propertyRow"}):e[r].ext.tags.indexOf("Serial")!==-1&&n.rowArr.push({th:l(e[r].id),td:e[r].input,trClass:"propertyRow"});var i="";return t.rowArr.length>0&&(i+=this.tableObjHtml(t)),n.rowArr.length>0&&(i+=this.tableObjHtml(n)),i},i.prototype.buildTableObjects=function(e,t){var n={};this.themeMode()?n={chartColorSection:{id:"te-colorOptions",label:"Chart Colors",rowObjArr:[]},surfaceSection:{id:"te-containerOptions",label:"Container Styles/Colors",rowObjArr:[]},fontSection:{id:"te-fontOptions",label:"Font Styles/Colors",rowObjArr:[]}}:n={nonSurfaceSection:{id:"te-chartOptions",label:"Chart Properties",rowObjArr:[]}};for(var r in t)this.themeMode()?r.toUpperCase().indexOf("FONT")===-1||t[r].arr[0].widget._class.indexOf("layout_Surface")!==-1&&r.toUpperCase().indexOf("COLOR")!==-1?r==="paletteID"?n.chartColorSection.rowObjArr.push(t[r]):t[r].arr[0].widget._class.indexOf("layout_Surface")!==-1&&n.surfaceSection.rowObjArr.push(t[r]):n.fontSection.rowObjArr.push(t[r]):t[r].arr[0].widget._class.indexOf("layout_Surface")===-1&&n.nonSurfaceSection.rowObjArr.push(t[r]);var i="";for(var s in n)i+=this.sharedPropertyTableHtml(n[s]);e.innerHTML+=i},i.prototype.initFunctionality=function(e){function n(e){if(t.showSettings()){var n=document.getElementById("te-save-button");n.onclick=function(e){var n=e.srcElement,r=n.previousSibling.value;if(r.length>1){var i=document.getElementById("te-load-theme"),s=i.getElementsByTagName("option"),o=!1,u;for(var a in s){var f=s[a].value;f===r&&(o=!0)}if(!o)u=t.save(r),i.innerHTML+="<option value='"+r+"'>"+r+"</option>";else{var l=confirm("'"+r+"' already exists. Do you want to overwrite the existing save? ");l&&(u=t.save(r))}n.previousSibling.value="",i.value=r}else alert("Save Name cannot be empty.")}}}function r(e){var n=e.getElementsByClassName("te-input");for(var r in n){if(isNaN(parseInt(r)))break;var i=n[r],s=i.getAttribute("id");if(s==="te-load-theme")i.onchange=function(e){var n=e.srcElement;t.load(n.value)};else if(s!==null&&s.indexOf("te-input-themeMode")!==-1)i.onchange=function(e){var n=e.srcElement;t.themeMode(n.checked);var r=document.getElementById("te-load-theme"),i=r!==null?r.value:"Default";t.load(i)};else if(i.tagName==="INPUT"||i.tagName==="SELECT"||i.tagName==="TEXTAREA")i.onchange=function(e){var n=e.srcElement,r=n.getAttribute("id");n.className.split(" ").indexOf("te-html-color-button")!==-1&&(r=n.previousSibling.getAttribute("id"),n.previousSibling.value=n.value);var i=n.getAttribute("type"),s=r.split("-"),o=s.slice(0,s.length-1).join("-")+"-",u=n.getAttribute("data-wids"),a=n.getAttribute("data-paramid"),f=u.split(",");f.forEach(function(e){var r=o+e,s=document.getElementById(r);if(i==="checkbox")s.checked=n.checked,t._widgetObjsById[e][a](n.checked);else if(n.getAttribute("data-type")==="array"){s.value=n.value;try{t._widgetObjsById[e][a](JSON.parse(n.value))}catch(u){}}else s.value=n.value,t._widgetObjsById[e][a](n.value),s.className.split(" ").indexOf("te-html-color-input")!==-1?s.nextSibling.value=n.value:s.className.split(" ").indexOf("te-html-color-button")!==-1&&(s.previousSibling.value=n.value)}),t.data().forEach(function(e){e.render()})}}}function i(e){var t=e.getElementsByClassName("te-section-table");for(var n in t)if(typeof t[n].getElementsByTagName=="function"){var r=t[n].getElementsByTagName("thead");r[0].onclick=function(e){var t=e.toElement;t.tagName==="TH"&&(t=t.parentElement.parentElement);var n=t.parentElement,r="";n.className.split(" ").indexOf("expanded")===-1?(n.className="te-section-table expanded",r="shown"):(n.className="te-section-table collapsed",r="hidden");var i=n.getElementsByTagName("tbody");i[0].className=r}}var i=e.getElementsByClassName("sharedPropertyRow");for(var s in i)if(typeof i[s].getElementsByClassName=="function"){var o=i[s].getElementsByClassName("te-label");o[0].onclick=function(e){var t=e.toElement,n=t.parentElement,r="";n.className.split(" ").indexOf("expanded")===-1?(n.className="sharedPropertyRow expanded",r="shown"):(n.className="sharedPropertyRow collapsed",r="hidden");var i=n.nextSibling;while(i!==null)i.className.split(" ").indexOf("sharedPropertyRow")===-1?(i.className="propertyRow "+r,i=i.nextSibling):i=null}}}var t=this;i(e),r(e),n(e)},i.prototype.sharedPropertyTableHtml=function(e){function n(e){var t=e.widget.classID().split("_"),n=t.join("/");return n+" <i>["+e.widget._id+"]</i>"}function r(e){return l(e.id)}function i(e,t){function i(e,t){var n=e.arr[t].widget[e.id]();return n!==null?n:""}var n=i(e,t),r=c(e,n,[e.arr[t]],e.arr[t].widget._id);return r}function s(e){function r(e){var t=e.arr[0].widget[e.id]();return e.arr.forEach(function(e,n){if(t!==e.widget[e.id]())return""}),t!==null?e.type==="array"?JSON.stringify(t):t:""}var t=r(e),n=c(e,t,e.arr,"shared");return n}var t={id:e.id,label:e.label,rowArr:[]};return e.rowObjArr.forEach(function(e){e.arr.forEach(function(o,u){u===0&&t.rowArr.push({th:r(e),td:s(e),trClass:"sharedPropertyRow collapsed"}),t.rowArr.push({th:n(o),td:i(e,u),trClass:"propertyRow hidden"})})}),this.tableObjHtml(t)},i.prototype.tableObjHtml=function(e){var t="<table id='"+e.id+"' class='te-section-table expanded'>";return t+="<thead><tr><th colspan='2'>"+e.label+"</th></tr></thead>",t+="<tbody>",e.rowArr.forEach(function(e){t+=this.tableRowObjHtml(e)},this),t+="</tbody>",t+"</table>"},i.prototype.tableRowObjHtml=function(e){var t=typeof e.trClass!="undefined"?"<tr class='"+e.trClass+"'>":"<tr>";return t+="<th class='te-label'>"+e.th+"</th>",t+="<td>"+e.td+"</td>",t+"</tr>"},i.prototype.setWidgetObjsById=function(e){var t=this,n=e.widget[e.id]();e.type==="widgetArray"?n.forEach(function(e){t._widgetObjsById[e._id]=e}):e.type==="widget"&&n!==null&&(this._widgetObjsById[n._id]=n)},i.prototype.checkTagFilter=function(e){var t=["Basic"],n=!1;return e.forEach(function(e){t.indexOf(e)!==-1&&(n=!0)}),n},i.prototype.findSharedProperties=function(e){function u(e,r){var i=[];if(e!==null){var s=n.discover(e);s.forEach(function(n,s){typeof n.ext.tags!="undefined"&&i.push({id:n.id,type:n.type,description:n.description,set:n.set,ext:n.ext,widget:e});if(n.type==="widgetArray"){var o=t.widgetProperty(e,n.id);o.forEach(function(e){var t=u(e,r+1);i=i.concat(t)})}else if(n.type==="widget"){var a=t.widgetProperty(e,n.id),f=u(a,r+1);i=i.concat(f)}})}return i}var t=this,r;if(typeof e!="undefined"&&e.length>0){var i=[];r={};var s={},o={};e.forEach(function(e){var t=u(e,0);i=i.concat(t)}),i.forEach(function(e){if(["widget","widgetArray"].indexOf(e.type)!==-1)t.setWidgetObjsById(e);else if(t.checkTagFilter(e.ext.tags)){var n=e.id;e.widget._class.indexOf("Surface")!==-1?(typeof s[n]=="undefined"&&(s[n]={arr:[]}),s[n].id=e.id,s[n].description=e.description,s[n].type=e.type,s[n].set=e.set,s[n].ext=e.ext,s[n].arr.push(e)):(typeof o[n]=="undefined"&&(o[n]={arr:[]}),o[n].id=e.id,o[n].description=e.description,o[n].type=e.type,o[n].set=e.set,o[n].ext=e.ext,o[n].arr.push(e)),typeof r[n]=="undefined"&&(r[n]={arr:[]}),r[n].id=e.id,r[n].description=e.description,r[n].type=e.type,r[n].set=e.set,r[n].ext=e.ext,r[n].arr.push(e)}})}return r},i});