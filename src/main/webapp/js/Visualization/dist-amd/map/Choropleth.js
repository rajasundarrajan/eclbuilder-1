(function(e,t){typeof define=="function"&&define.amd?define(["d3","topojson","./Layer","../common/Palette","../api/ITooltip","css!./Choropleth"],t):e.map_Choropleth=t(e.d3,e.topojson,e.map_Layer,e.common_Palette,e.api_ITooltip)})(this,function(e,t,n,r,i){function s(){n.call(this),i.call(this),this._dataMap={},this._path=e.select(null)}return s.prototype=Object.create(n.prototype),s.prototype.constructor=s,s.prototype._class+=" map_Choropleth",s.prototype.implements(i.prototype),s.prototype._palette=r.rainbow("default"),s.prototype.publish("paletteID","YlOrRd","set","Palette ID",s.prototype._palette.switch(),{tags:["Basic","Shared"]}),s.prototype.publish("useClonedPalette",!1,"boolean","Enable or disable using a cloned palette",null,{tags:["Intermediate","Shared"]}),s.prototype.publish("opacity",1,"number","Opacity",null,{tags:["Advanced"]}),s.prototype.publish("meshVisible",!0,"boolean","Mesh Visibility"),s.prototype.publish("meshColor",null,"html-color","Stroke Color",null,{optional:!0}),s.prototype.publish("meshStrokeWidth",.25,"number","Stroke Width"),s.prototype.publish("internalOnly",!1,"boolean","Internal mesh only"),s.prototype.data=function(e){var t=n.prototype.data.apply(this,arguments);if(arguments.length){this._dataMap={},this._dataMinWeight=null,this._dataMaxWeight=null;var r=this;this.data().forEach(function(e){r._dataMap[e[0]]=e;if(!r._dataMinWeight||e[1]<r._dataMinWeight)r._dataMinWeight=e[1];if(!r._dataMaxWeight||e[1]>r._dataMaxWeight)r._dataMaxWeight=e[1]})}return t},s.prototype.layerEnter=function(e,t,r){n.prototype.layerEnter.apply(this,arguments),this._choroplethTransform=t.append("g"),this._choropleth=this._choroplethTransform.append("path").attr("class","mesh")},s.prototype.layerUpdate=function(e){n.prototype.layerUpdate.apply(this,arguments),this._palette=this._palette.switch(this.paletteID()),this.useClonedPalette()&&(this._palette=this._palette.cloneNotExists(this.paletteID()+"_"+this.id()));if(!this.visible()||!this.meshVisible()){this._choropleth.attr("d",""),delete this._prevProjection;return}if(this._prevProjection!==e.projection()||this._prevInternalOnly!==this.internalOnly())this._choropleth.attr("d",e._d3GeoPath(t.mesh(this._choroTopology,this._choroTopologyObjects,this.internalOnly()?function(e,t){return e!==t}:function(e,t){return!0}))),this._prevProjection=e.projection(),this._prevInternalOnly=this.internalOnly();this._choroplethTransform.style("opacity",this.opacity()).style("stroke",this.meshColor())},s.prototype.layerExit=function(e){delete this._prevProjection,delete this._prevInternalOnly},s.prototype.layerZoomed=function(e){n.prototype.layerZoomed.apply(this,arguments),this._choroplethTransform.attr("transform","translate("+e._zoom.translate()+")scale("+e._zoom.scale()+")").style("stroke-width",this.meshStrokeWidth()/e._zoom.scale()+"px")},s.prototype.click=function(e,t,n){console.log("Click:  "+JSON.stringify(e)+", "+t+", "+n)},s});