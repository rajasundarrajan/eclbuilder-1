(function(e,t){typeof define=="function"&&define.amd?define(["d3","topojson","./Layer","./Utility","css!./OpenStreet"],t):e.map_OpenStreet=t(e.d3,e.topojson,e.map_Layer,e.map_Utility)})(this,function(e,t,n,r){function i(){n.call(this)}return i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype._class+=" map_OpenStreet",i.prototype._copyrightText="Â© OpenStreetMap contributors",i.prototype.publish("tileProvider","OpenStreetMap","set","Tile Provider",["OpenStreetMap","OpenStreetMap Hot","MapQuest","MapQuest Sat","Stamen Watercolor","OpenCycleMap"],{tags:["Basic","Shared"]}),i.prototype.layerEnter=function(e,t,i){n.prototype.layerEnter.apply(this,arguments),this._tile=r.Tile(),this._openStreetTransform=t.append("g"),this._openStreet=this._openStreetTransform.append("g"),this._copyright=t.append("text").attr("x",-100).attr("y",-100).style("opacity",.5).text(this._copyrightText),this._copyrightBBox=this._copyright.node().getBBox()},i.prototype.layerUpdate=function(e){this.visible()?this._copyright.attr("x",e.width()-this._copyrightBBox.width-this._copyrightBBox.height/2).attr("y",e.height()-this._copyrightBBox.height/2).text(this._copyrightText):this._copyright.text("")},i.prototype.layerZoomed=function(e){var t=[];if(this.visible()){var n=e.project(-85,180);if(!n||n[0]<=0||n[1]<=0)n=[e.width(),e.height()];this._tile.size([Math.min(e.width(),n[0]),Math.min(e.height(),n[1])]).scale(e._zoom.scale()*4096).translate(e._zoom.translate()),t=this._tile(),this._openStreetTransform.attr("transform","scale("+t.scale+")translate("+t.translate+")")}this._prevTileProvider!==this.tileProvider()&&(this._openStreet.selectAll("image").remove(),this._prevTileProvider=this.tileProvider());var r=this,i=this._openStreet.selectAll("image").data(t,function(e){return e[2]+"/"+e[0]+"/"+e[1]});i.enter().append("image").attr("xlink:href",function(e){switch(r.tileProvider()){case"OpenStreetMap Hot":return"http://"+["a","b","c"][Math.random()*3|0]+".tile.openstreetmap.fr/hot/"+e[2]+"/"+e[0]+"/"+e[1]+".png";case"MapQuest":return"http://otile"+["1","2","3","4"][Math.random()*4|0]+".mqcdn.com/tiles/1.0.0/osm/"+e[2]+"/"+e[0]+"/"+e[1]+".png";case"MapQuest Sat":return"http://otile"+["1","2","3","4"][Math.random()*4|0]+".mqcdn.com/tiles/1.0.0/sat/"+e[2]+"/"+e[0]+"/"+e[1]+".png";case"Stamen Watercolor":return"http://"+["a","b","c"][Math.random()*3|0]+".tile.stamen.com/watercolor/"+e[2]+"/"+e[0]+"/"+e[1]+".png";case"OpenCycleMap":return"http://"+["a","b"][Math.random()*2|0]+".tile.opencyclemap.org/cycle/"+e[2]+"/"+e[0]+"/"+e[1]+".png";default:return"http://"+["a","b","c"][Math.random()*3|0]+".tile.openstreetmap.org/"+e[2]+"/"+e[0]+"/"+e[1]+".png"}}).attr("width",1).attr("height",1).attr("x",function(e){return e[0]}).attr("y",function(e){return e[1]}).style("opacity",0).transition().duration(500).style("opacity",1),i.exit().remove()},i});