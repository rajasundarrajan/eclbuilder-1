(function(e,t){typeof define=="function"&&define.amd?define(["d3","../common/SVGWidget","../api/ITree","../common/Text","../common/FAChar","css!./SunburstPartition"],t):e.tree_SunburstPartition=t(e.d3,e.common_SVGWidget,e.api_ITree,e.common_Text,e.common_FAChar)})(this,function(e,t,n,r,i){function s(e){t.call(this),n.call(this)}return s.prototype=Object.create(t.prototype),s.prototype.constructor=s,s.prototype._class+=" tree_SunburstPartition",s.prototype.implements(n.prototype),s.prototype.publish("paletteID","default","set","Palette ID",s.prototype._palette.switch(),{tags:["Basic","Shared"]}),s.prototype.publish("useClonedPalette",!1,"boolean","Enable or disable using a cloned palette",null,{tags:["Intermediate","Shared"]}),s.prototype.root=function(e){return arguments.length?(this._root=e,this.svg&&this.svg.selectAll("path").transition().duration(750).attrTween("d",this.arcTweenFunc(this._root)),this):this._root||this.data()},s.prototype.data=function(){var e=t.prototype.data.apply(this,arguments);return arguments.length&&(this._resetRoot=!0),e},s.prototype.enter=function(t,n){var r=this;this.radius=Math.min(this.width(),this.height())/2,this._xScale=e.scale.linear().range([0,2*Math.PI]),this._yScale=e.scale.sqrt().range([0,this.radius]),this.partition=e.layout.partition().value(function(e){return e.value!==undefined?e.value:1}),this.arc=e.svg.arc().startAngle(function(e){return Math.max(0,Math.min(2*Math.PI,r._xScale(e.x)))}).endAngle(function(e){return Math.max(0,Math.min(2*Math.PI,r._xScale(e.x+e.dx)))}).innerRadius(function(e){return Math.max(0,r._yScale(e.y))}).outerRadius(function(e){return Math.max(0,r._yScale(e.y+e.dy))}),this.svg=n.append("g")},s.prototype.update=function(t,n){function s(t){e.event&&e.event.stopPropagation(),r.root(t)}var r=this;this._palette=this._palette.switch(this.paletteID()),this.useClonedPalette()&&(this._palette=this._palette.cloneNotExists(this.paletteID()+"_"+this.id())),this.radius=Math.min(this.width(),this.height())/2,this._xScale.range([0,2*Math.PI]),this._yScale.range([0,this.radius]),this._dataNodes=this.partition.nodes(this.data());var i=this.svg.selectAll("path").data(this._dataNodes,function(e,t){return e.id!==undefined?e.id:t});i.enter().append("path").on("click",function(e){r.click(e)}).on("dblclick",s).append("title"),i.attr("d",this.arc).style("fill",function(e){return e.__viz_fill?e.__viz_fill:r._palette(e.label)}).style("stroke",function(e){return e.value>16?"white":"none"}).select("title").text(function(e){return e.label}),i.exit().remove(),this._resetRoot&&(this._resetRoot=!1,this.root(this._dataNodes[0]))},s.prototype.arcTweenFunc=function(t){var n=e.interpolate(this._xScale.domain(),[t.x,t.x+t.dx]),r=e.interpolate(this._yScale.domain(),[t.y,1]),i=e.interpolate(this._yScale.range(),[t.y?20:0,this.radius]),s=this;return function(e,t){return t?function(t){return s.arc(e)}:function(t){return s._xScale.domain(n(t)),s._yScale.domain(r(t)).range(i(t)),s.arc(e)}}},s});