(function(e,t){typeof define=="function"&&define.amd?define(["d3","../common/HTMLWidget","./Cell","../common/Text","css!./Border"],t):e.layout_Border=t(e.d3,e.common_HTMLWidget,e.layout_Cell,e.common_Text)})(this,function(e,t,n,r){function i(){t.call(this),this._tag="div",this._colCount=0,this._rowCount=0,this._colSize=0,this._rowSize=0,this._shrinkWrapBoxes={},this.content([]),this.sectionTypes([])}return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,i.prototype._class+=" layout_Border",i.prototype.publish("designMode",!1,"boolean","Design Mode",null,{tags:["Basic"]}),i.prototype.publish("content",[],"widgetArray","widgets",null,{tags:["Intermediate"]}),i.prototype.publish("gutter",0,"number","Gap Between Widgets",null,{tags:["Basic"]}),i.prototype.publish("topShrinkWrap",!1,"boolean","'Top' Cell shrinks to fit content",null,{tags:["Intermediate"]}),i.prototype.publish("leftShrinkWrap",!1,"boolean","'Left' Cell shrinks to fit content",null,{tags:["Intermediate"]}),i.prototype.publish("rightShrinkWrap",!1,"boolean","'Right' Cell shrinks to fit content",null,{tags:["Intermediate"]}),i.prototype.publish("bottomShrinkWrap",!1,"boolean","'Bottom' Cell shrinks to fit content",null,{tags:["Intermediate"]}),i.prototype.publish("topSize",0,"number","Height of the 'Top' Cell (px)",null,{tags:["Private"]}),i.prototype.publish("leftSize",0,"number","Width of the 'Left' Cell (px)",null,{tags:["Private"]}),i.prototype.publish("rightSize",0,"number","Width of the 'Right' Cell (px)",null,{tags:["Private"]}),i.prototype.publish("bottomSize",0,"number","Height of the 'Bottom' Cell (px)",null,{tags:["Private"]}),i.prototype.publish("topPercentage",20,"number","Percentage (of parent) Height of the 'Top' Cell",null,{tags:["Private"]}),i.prototype.publish("leftPercentage",20,"number","Percentage (of parent) Width of the 'Left' Cell",null,{tags:["Private"]}),i.prototype.publish("rightPercentage",20,"number","Percentage (of parent) Width of the 'Right' Cell",null,{tags:["Private"]}),i.prototype.publish("bottomPercentage",20,"number","Percentage (of parent) Height of the 'Bottom' Cell",null,{tags:["Private"]}),i.prototype.publish("surfacePadding",0,"number","Cell Padding (px)",null,{tags:["Intermediate"]}),i.prototype.publish("sectionTypes",[],"array","Section Types sharing an index with 'content' - Used to determine position/size.",null,{tags:["Private"]}),i.prototype.watchWidget=function(e){this._watch===undefined&&(this._watch={}),this._watch[e.id()]&&(this._watch[e.id()].remove(),delete this._watch[e.id()]);if(e){var t=this;this._watch[e.id()]=e.monitor(function(e,n,r){r!==n&&t.lazyPostUpdate()})}},i.prototype.lazyPostUpdate=i.prototype.debounce(function(){this.postUpdate()},100),i.prototype.applyLayoutType=function(){var e=this.borderLayoutObject();this.content().forEach(function(t,n){t._fixedLeft=e[this.sectionTypes()[n]].left,t._fixedTop=e[this.sectionTypes()[n]].top,t._fixedWidth=e[this.sectionTypes()[n]].width,t._fixedHeight=e[this.sectionTypes()[n]].height,t._dragHandles=this.cellSpecificDragHandles(this.sectionTypes()[n])},this)},i.prototype.cellSpecificDragHandles=function(e){switch(e){case"top":return["s"];case"right":return["w"];case"bottom":return["n"];case"left":return["e"];case"center":return[]}},i.prototype.borderLayoutObject=function(e){function y(e){e.width.px=typeof e.width.px!="undefined"?e.width.px:0,e.width["%"]=typeof e.width["%"]!="undefined"?e.width["%"]:0,e.height.px=typeof e.height.px!="undefined"?e.height.px:0,e.height["%"]=typeof e.height["%"]!="undefined"?e.height["%"]:0;var t={width:e.width.px+e.width["%"]/100*u.width(),height:e.height.px+e.height["%"]/100*u.height(),top:e.top.px+e.top["%"]/100*u.height()+u.gutter()/2,left:e.left.px+e.left["%"]/100*u.width()+u.gutter()/2};return t}var t,n,r,i,s,o={},u=this,a,f,l,c,h,p,d,v,m=this.target().getBoundingClientRect(),g={};return g.top=m.top,g.left=m.left,g.bottom=m.bottom,g.right=m.right,this.target()instanceof SVGElement?(g.width=parseFloat(this.target().getAttribute("width")),g.height=parseFloat(this.target().getAttribute("height"))):(g.width=m.width,g.height=m.height),this.sectionTypes().indexOf("top")!==-1&&(a=this.topSize(),f=this.topPercentage(),typeof this._shrinkWrapBoxes["top"]!="undefined"&&(a=this._shrinkWrapBoxes.top.height+this.gutter(),f=0)),this.sectionTypes().indexOf("bottom")!==-1&&(l=this.bottomSize(),c=this.bottomPercentage(),typeof this._shrinkWrapBoxes["bottom"]!="undefined"&&(l=this._shrinkWrapBoxes.bottom.height+this.gutter(),c=0)),this.sectionTypes().indexOf("left")!==-1&&(h=this.leftSize(),p=this.leftPercentage(),typeof this._shrinkWrapBoxes["left"]!="undefined"&&(h=this._shrinkWrapBoxes.left.width+this.gutter(),p=0)),this.sectionTypes().indexOf("right")!==-1&&(d=this.rightSize(),v=this.rightPercentage(),typeof this._shrinkWrapBoxes["right"]!="undefined"&&(d=this._shrinkWrapBoxes.right.width+this.gutter(),v=0)),t=y({width:{px:0,"%":100},height:{px:a,"%":f},top:{px:0,"%":0},left:{px:0,"%":0}}),n=y({width:{px:0,"%":100},height:{px:l,"%":c},top:{px:0,"%":100},left:{px:0,"%":0}}),n.top-=n.height,i=y({width:{px:h,"%":p},height:{px:-t.height-n.height,"%":100},top:{px:t.height,"%":0},left:{px:0,"%":0}}),r=y({width:{px:d,"%":v},height:{px:-t.height-n.height,"%":100},top:{px:t.height,"%":0},left:{px:0,"%":100}}),r.left-=r.width,s=y({width:{px:-r.width-i.width,"%":100},height:{px:-t.height-n.height,"%":100},top:{px:t.height,"%":0},left:{px:i.width,"%":0}}),o.top=t,o.bottom=n,o.right=r,o.left=i,o.center=s,o},i.prototype.clearContent=function(t){if(!t)this.content().forEach(function(e){return e.target(null),!1}),e.select("#"+this.id()+" > div.borderHandle").classed("borderHandleDisabled",!0),delete this._watch,this.content([]),this.sectionTypes([]);else{var n=this.sectionTypes().indexOf(t);n>=0&&(this._watch&&this.content()[n]&&delete this._watch[this.content()[n].id()],this.content()[n].target(null),e.select("#"+this.id()+" > div.borderHandle_"+t).classed("borderHandleDisabled",!0),this.content().splice(n,1),this.sectionTypes().splice(n,1))}},i.prototype.hasContent=function(e,t,n){return this.sectionTypes().indexOf(e)>=0},i.prototype.setContent=function(e,t,r){this.clearContent(e),r=typeof r!="undefined"?r:"";if(t){var i=(new n).surfaceBorderWidth(0).widget(t).title(r);this.watchWidget(t),this.content().push(i),this.sectionTypes().push(e)}return this},i.prototype.getContent=function(e){var t=this.sectionTypes().indexOf(e);return t>=0?this.content()[t].widget():null},i.prototype.setLayoutOffsets=function(){this._offsetX=this._element.node().getBoundingClientRect().left+this.gutter()/2,this._offsetY=this._element.node().getBoundingClientRect().top+this.gutter()/2},i.prototype.dragStart=function(t){e.event.sourceEvent.stopPropagation();var n=this;this._dragCell=t,this._dragCellStartSize=this[t+"Size"](),this[t+"ShrinkWrap"]()&&(this[t+"Percentage"](0),this[t+"ShrinkWrap"](!1));var r=e.select("#"+n.id()+" > div.borderHandle_"+t);n._handleTop=parseFloat(r.style("top").split("px")[0]),n._handleLeft=parseFloat(r.style("left").split("px")[0]),this._dragPrevX=e.event.sourceEvent.clientX,this._dragPrevY=e.event.sourceEvent.clientY},i.prototype.dragTick=function(t){function s(t,r){if(r===0)return;var i=e.selectAll("#"+n.id()+" > div.borderHandle"),s=e.select("#"+n.id()+" > div.borderHandle_"+t);s.classed("borderHandle_top")?(s.style({top:n._handleTop-r+"px"}),n._cellSizes.topHeight=n._handleTop-r,n._cellSizes.leftHeight=n._cellSizes.height,n._cellSizes.leftHeight-=n._cellSizes.topHeight,n._cellSizes.leftHeight-=n._cellSizes.bottomHeight,n._cellSizes.rightHeight=n._cellSizes.leftHeight):s.classed("borderHandle_right")?(s.style({left:n._handleLeft-r+"px"}),n._cellSizes.rightWidth=n._cellSizes.width-n._handleLeft+r):s.classed("borderHandle_bottom")?(s.style({top:n._handleTop-r+"px"}),n._cellSizes.bottomHeight=n._cellSizes.height-n._handleTop+r,n._cellSizes.leftHeight=n._cellSizes.height,n._cellSizes.leftHeight-=n._cellSizes.bottomHeight,n._cellSizes.leftHeight-=n._cellSizes.topHeight,n._cellSizes.rightHeight=n._cellSizes.leftHeight):s.classed("borderHandle_left")&&(s.style({left:n._handleLeft-r+"px"}),n._cellSizes.leftWidth=n._handleLeft-r),i.each(function(){var t=e.select(this);t.classed("borderHandle_top")?t.style({width:n._cellSizes.width+"px",top:n._cellSizes.topHeight-3+"px"}):t.classed("borderHandle_right")?t.style({left:n._cellSizes.width-n._cellSizes.rightWidth+"px",top:n._cellSizes.topHeight+3+"px",height:n._cellSizes.rightHeight+"px"}):t.classed("borderHandle_bottom")?t.style({width:n._cellSizes.width+"px",top:n._cellSizes.height-n._cellSizes.bottomHeight-3+"px"}):t.classed("borderHandle_left")&&t.style({left:n._cellSizes.leftWidth+"px",height:n._cellSizes.leftHeight+"px",top:n._cellSizes.topHeight+3+"px"})})}var n=this,r=this._dragPrevX-e.event.sourceEvent.clientX,i=this._dragPrevY-e.event.sourceEvent.clientY;switch(t){case"top":case"bottom":s(t,i);break;case"right":case"left":s(t,r)}},i.prototype.dragEnd=function(t){if(t){var n=this._dragPrevX-e.event.sourceEvent.clientX,r=this._dragPrevY-e.event.sourceEvent.clientY;switch(t){case"top":r!==0&&(this.topPercentage(0),this.topSize(this.topSize()===0?this.getContent("top").getBBox().height-r:this.topSize()-r));break;case"right":n!==0&&(this.rightPercentage(0),this.rightSize(this.rightSize()===0?this.getContent("right").getBBox().width+n:this.rightSize()+n));break;case"bottom":r!==0&&(this.bottomPercentage(0),this.bottomSize(this.bottomSize()===0?this.getContent("bottom").getBBox().height+r:this.bottomSize()+r));break;case"left":n!==0&&(this.leftPercentage(0),this.leftSize(this.leftSize()===0?this.getContent("left").getBBox().width-n:this.leftSize()-n))}this._dragPrevX=e.event.sourceEvent.clientX,this._dragPrevY=e.event.sourceEvent.clientY}this.render()},i.prototype.size=function(e){var n=t.prototype.size.apply(this,arguments);return arguments.length&&this.contentDiv&&this.contentDiv.style("width",this._size.width+"px").style("height",this._size.height+"px"),n},i.prototype.enter=function(n,r){t.prototype.enter.apply(this,arguments);var i=this;r.style("position","relative"),this.contentDiv=r.append("div").classed("border-content",!0),this._scrollBarWidth=this.getScrollbarWidth(),this._borderHandles=["top","left","right","bottom"];var s=r.selectAll("div.borderHandle").data(this._borderHandles);s.enter().append("div").classed("borderHandle",!0).each(function(t){var n=e.select(this);n.classed("borderHandle_"+t,!0).classed("borderHandleDisabled",i.getContent(t)===null)})},i.prototype.update=function(n,r){t.prototype.update.apply(this,arguments),this._sectionTypeArr=this.sectionTypes();var i=this;r.classed("design-mode",this.designMode()),this.setLayoutOffsets();var s=this.contentDiv.selectAll(".cell_"+this._id).data(this.content(),function(e){return e._id});s.enter().append("div").classed("cell_"+this._id,!0).style("position","absolute").each(function(t,n){e.select(this).classed("border-cell border-cell-"+i._sectionTypeArr[n],!0),t.target(this),e.select("#"+i.id()+" > div.borderHandle_"+i._sectionTypeArr[n]).classed("borderHandleDisabled",!1)}),s.each(function(e,t){var n=i.sectionTypes()[t];typeof i[n+"ShrinkWrap"]!="undefined"&&i[n+"ShrinkWrap"]()?(e.render(),i._shrinkWrapBoxes[n]=e.widget().getBBox(!0)):delete i._shrinkWrapBoxes[n]});var o=e.behavior.drag().on("dragstart",function(e,t){i.dragStart.call(i,e,t)}).on("drag",function(e,t){i.dragTick.call(i,e,t)}).on("dragend",function(e,t){i.dragEnd.call(i,e,t)});this.designMode()?r.selectAll("#"+this.id()+" > div.borderHandle").call(o):r.selectAll("#"+this.id()+" > div.borderHandle").on(".drag",null);var u=this.borderLayoutObject();this.content().forEach(function(e,t){e._fixedLeft=u[this.sectionTypes()[t]].left,e._fixedTop=u[this.sectionTypes()[t]].top,e._fixedWidth=u[this.sectionTypes()[t]].width,e._fixedHeight=u[this.sectionTypes()[t]].height,e._dragHandles=[]},this),s.style("left",function(e){return e._fixedLeft+"px"}).style("top",function(e){return e._fixedTop+"px"}).style("width",function(e){return e._fixedWidth-i.gutter()+"px"}).style("height",function(e){return e._fixedHeight-i.gutter()+"px"}).each(function(e){e._parentElement.attr("draggable",i.designMode()).selectAll(".dragHandle").attr("draggable",i.designMode()),e.surfacePadding(i.surfacePadding()).resize()}),s.exit().each(function(e){e.target(null)}).remove(),this.getCellSizes(),r.selectAll("#"+this.id()+" > div.borderHandle").each(function(){var t=e.select(this);t.classed("borderHandle_top")?t.style({width:i._cellSizes.width+"px",top:i._cellSizes.topHeight-3+"px"}):t.classed("borderHandle_right")?t.style({left:i._cellSizes.width-i._cellSizes.rightWidth+"px",top:i._cellSizes.topHeight+3+"px",height:i._cellSizes.rightHeight+"px"}):t.classed("borderHandle_bottom")?t.style({width:i._cellSizes.width+"px",top:i._cellSizes.height-i._cellSizes.bottomHeight-3+"px"}):t.classed("borderHandle_left")&&t.style({left:i._cellSizes.leftWidth+"px",height:i._cellSizes.leftHeight+"px",top:i._cellSizes.topHeight+3+"px"})})},i.prototype.getCellSizes=function(){var t=this;t._cellSizes={};var n=this.element().node().getBoundingClientRect();t._cellSizes.width=n.width,t._cellSizes.height=n.height,this.element().selectAll("#"+this.id()+" > div > div.border-cell").each(function(){var n=e.select(this);if(typeof n.node=="function"){var r=n.node().getBoundingClientRect();n.classed("border-cell-top")?t._cellSizes.topHeight=r.height:n.classed("border-cell-left")?(t._cellSizes.leftWidth=r.width,t._cellSizes.leftHeight=r.height):n.classed("border-cell-right")?(t._cellSizes.rightWidth=r.width,t._cellSizes.rightHeight=r.height):n.classed("border-cell-bottom")&&(t._cellSizes.bottomHeight=r.height)}});var r=["height","width","topHeight","bottomHeight","leftHeight","rightHeight","leftWidth","rightWidth"];r.forEach(function(e){t._cellSizes[e]=t._cellSizes[e]===undefined?0:t._cellSizes[e]})},i.prototype.postUpdate=function(e,t){var n=this;this.content().forEach(function(e){if(e._element.node()!==null){var t=e.widget().getBBox(),r=e.widget().getBBox(!0);(t.width!==r.width||t.height!==r.height)&&n.render()}})},i.prototype.exit=function(e,n){t.prototype.exit.apply(this,arguments)},i});